\newpage

# Chapter 2: A new measure of environmental variance {#var-raster}

## Disentangling changes in mean and stochastcity

\noindent Whether an animal can perceive stochasticity depends strongly on the spatiotemporal scale of the process(es) involved. Organisms are most affected by stochastic events and processes that occur on time scales which are on the order of the organisms' life spans or generation times [@southwood_habitat_1977]. Weekly heavy rains that alter a lake's salinity may be perceived as stochastic events, while a slow, multi-centennial drought and the high salinity that follows it should be viewed as a (undetectable) change in average conditions. However, since the distinction between changes in mean and spikes in variance depends on the organism of reference, producing a reasonable estimate of resource stochasticity is not simple [@steixner-kumar_strategies_2020].

I will estimate resource stochasticity using rasters of Normalized Difference Vegetation Index [NDVI, see @pettorelli_normalized_2011] from the Advanced Very High Resolution Radiometer (AVHRR) satellites at a daily temporal frequency and a 0.5-degree resolution. While a finer spatial resolution would contain more information about landscapes' stochasticity<!-- (figure \@ref(fig:stochsticity))-->, it would also increase the size of the dataset and computational costs unnecessarily, as the models will be designed for large-scale spatial changes (i.e., on the order of kilometers). In contrast, while coarsening the data temporally would greatly increase the risk of missing important stochastic events which occur over short time spans (e.g., short-term green-ups, floods, and small fires).

```{r stochsticity, eval = FALSE, fig.cap="An animal's perception of environmental variance depends on the animal's spatiotemporal perception scale. (a) On the left, spatially correlated gaussian random variables in a two-dimensional space. The other two panels shows the the spatially aggregated means using the data from the left panel and sample sizes of $10^2$ (center) and $100^2$ (right). (b) Environmental variance calculated using all the random variables (top left panel) at different levels of aggregation. Larger sample sizes have a wider range of values, which results in higher variance at larger sample sizes. (c) Environmental variance calculated using the aggregated means from panel (a). Note that the variance estimates in panel (c) are affected by the information loss that results from the spatial aggregation. Therefore, an animal's perceived variance depends on the spatiotemporal scale it perceives events at.", out.width = '\\textwidth'}
knitr::include_graphics('../../figures/spatial-variance.png')
```

## Quantifying environmental variance

\noindent Productivity varies strongly over both space and time. Equatorial and tropical regions tend to have higher productivity than polar regions, and productivity also tends to be higher in warmer seasons than in colder ones. However, the intensity of inter-annual variation strongly depends on location, too: Equatorial ecosystems experience very little seasonality, while arctic regions have marked growth and dormancy periods. Similarly, the stochasticity in productivity also varies spatiotemporally, since both highly productive habitats (e.g., the Amazon) and barren habitats (e.g., deserts) tend to be more predictable than environments with intermediate productivity, and stochasticity is highest during seasons of change (e.g., growth seasons and the timing of colder weather, including higher stochasticity in temperature in cold regions). Consequently, the model of mean and variance in NDVI should account for each of these complex spatiotemporal trends.

Generalized Additive Models [GAMs, see @wood_fast_2011; @wood_generalized_2017] are flexible statistical models which allow analysts to estimate complex, smooth trends in a data-informed manner [@simpson_modelling_2018]. Importantly, GAMs do not require the response to be (conditionally) normally distributed. Instead, they support a variety of families of distributions from the exponential set of distributions. This is important when modeling modeling biological data, such as NDVI, since the response's variance (i.e., $\var(R)$) often depends on its mean (i.e., $\e(R)$). This is because as the mean NDVI approaches a boundary (-1 or 1), the range of possible values decreases (due to the boundary) and it becomes increasingly more unlikely for NDVI to take a value near the opposite boundary. Biologically, this means that a location with a mean NDVI of +1 (e.g., the Amazon) is highly unlikely to have a value near -1 (or even 0).

Since NDVI is bounded in the $[-1. 1]$ range, I could model NDVI using a GAM with a beta family of distributions (after scaling NDVI to the interval [0, 1] using the transformation $(\nu + 1) / 2$, where $\nu$ is NDVI). The model could include a (cyclic) smooth of day of year to account for seasonal trends, a smooth of year to account for long-term trends, and a two-dimensional smooth of space to account for differences between habitats. Additionally, including a tensor interaction term of day of year and space would allow the seasonal trends to vary over space (including inverting the seasonal trend between hemispheres), while a tensor interaction term of year and space would allow locations to deviate from the average long-term. Since the beta distribution only supports values in the interval [0, 1], the variance of a beta random distribution is bounded in the interval (0, 0.25]. Under the assumption of a constant scale parameter (as is the case with GAMs), the variance tends to 0 as the mean tends to 0 or 1. Consequently, the variance in NDVI depends on the mean and thus vary over time and space, but the mean-variance relationship is spatiotemporally.

Generalized Additive Models for Location and Scale [GAMLSs; @stasinopoulos_generalized_2007] are a class of GAMs which allow one to estimate smooth trends in both the mean and the variance around the mean while relaxing the assumption of a constant mean-variance relationship. While beta location-scale models are currently not supported by the `mgcv` package, we have been collaborating with the packages' main author, Dr. Simon Wood, to develop code for the `betals` family. The GAMLS would include all terms detailed above for both the mean and scale parameters' linear predictors.

<!-- Since GAMs are highly flexible, they are prone to over-fitting, particularly when data is abundant [@wood_generalized_2015; @wood_generalized_2017-1; @wood_generalized_2017] and when models estimate multiple parameters in a distribution, such as GAMLSs. However, careful model design and model penalization can greatly limit any of these concerns [@simpson_modelling_2018]. ***Overall, all mean terms should be smooth but variance terms should have k/2*** ***here***


The smooth of time, $f_1(t)$ could be modeled with a thin-plate spline smooth [@wood_thin_2003; @simpson_modelling_2018], while the two-dimensional spatial term, $f_2(s_1, s_2)$, should use a two-dimensional spline. While splines on the sphere [@wahba_spline_1981] would provide a good approximation for the shape of the earth, $Z$ will likely be constrained to terrestrial or freshwater habitats, so Duchon splines are a better alternative [@duchon_splines_1977]. Duchon splines are well-behaved as they move away from the support of the data, so they are less likely to produce questionable edge behavior. Finally, the interaction term $f_3(t, s_1, s_2)$ can be modeled as the tensor interaction product [@wood_straightforward_2013] of time and space, with a thin-plate spline smooth for time and a Duchon spline for space. To reduce computation time, the GAM will be fit using the `bam()` function from the `mgcv` package, which fits models similarly to `mgcv::gam()` but is specific for fitting models to very large datasets. `bam()` allows model fitting using fast restricted maximum likelihood and discretized covariates [@li_faster_2020; @wood_generalized_2017-1; @wood_generalized_2015], with no appreciable loss to model fit.

<!-- could add mention to the study that used the geometric mean as a simple option -->


To my knowledge, there currently is no large-scale measurement of environmental variance. High-resolution, worldwide, spatiotemporally dynamic estimates mean and variance in NDVI would allow researchers to begin studying the effects of spatiotemporal environmental variance on various aspects of animal behavior, including the timing and drivers of animals' spatial needs, movement (including migration and nomadism), and territoriality, and reproduction. The data could also be used to study large-scale phenology events and effects of climate change.
